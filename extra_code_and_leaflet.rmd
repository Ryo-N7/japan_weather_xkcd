---
title: "extra_leaflet_and_code"
author: "RN7"
date: "November 23, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

A quick reminder that the formula is: $$\large\frac{(Fahrenheit - 32)\cdot5}{9} = Celsius$$
For those curious the formula is: $$\large Temperature (Celsius) + 0.5555\left(6.11e^{5417.753(\frac{1}{273.16}-\frac{1}{273.15+Dew Point})} - 10\right) $$

```{r avg. summer and winter}

library(ggplot2)
library(ggrepel)
library(xkcd)
library(extrafont)

xrange <- range(climate_japan$summer_humidex)
yrange <- range(climate_japan$winter_avg_temp)

set.seed(8)


climate_japan %>% 
  ggplot(aes(summer_avg_temp, winter_avg_temp)) +
  geom_point() +
  geom_text_repel(aes(label = City), 
                  family = "xkcd",
                  max.iter = 50000) +
  ggtitle("Where to live in Japan based on your temperature preferences!",
          subtitle = "Data from airport weather stations, 2016-2017") +
  xlab("Avg. summer temperature in Celsius") +
  ylab("Avg. winter temperature in Celsius") +
  xkcdaxis(xrange = xrange,
           yrange = yrange) +
  theme_xkcd() +
  theme(text = element_text(size = 16, family = "xkcd")) +
  annotate("text", x = 15, y = 0, label = "Hokkaido Island", family = "xkcd", size = 6) +
  annotate("segment", y = 2, yend = -5.5, x = 18.7, xend = 20.6, color = "blue", size = 1.5) +
  annotate("segment", y = -3, yend = -5.5, x = 14.5, xend = 16.5, color = "blue", size = 1.5) +
  annotate("text", x = 25, y = 20, label = "Okinawa and \nRyukyu Islands", family = "xkcd", size = 5) +
  annotate("segment", y = 17.5, yend = 15, x = 26, xend = 29.5, color = "darkred", size = 1.5) +
  annotate("segment", y = 22, yend = 22, x = 27, xend = 30.5, color = "darkred", size = 1.5) +
  annotate("text", x = 18.5, y = 10, label = "Honshu, Kyushu, \n and Shikoku Islands", family = "xkcd", size = 5.5)

```













```{r include=FALSE}
# Leaflet ####

# Tourist areas:

tour <- data_frame(
  location = c("Hokkaido", "Tohoku", "Tokyo", "Osaka", 
               "Kobe", "Shikoku", "Hiroshima", "Kyushu", "Okinawa"),
  City = c("Sapporo", "Aomori", "Tokyo", "Osaka", "Kobe", 
           "Kochi", "Hiroshima", "Matsuyama", "Naha")
)

tour <- left_join(tour, climate_japan_map, by = "City")

# Not have Kanazawa, Kyoto, and Nara >>> just have to manually add in i guess?
# Use the `geocode()` function from `ggmap` package to grab the longitude and latitude data.
# won't let me do all 3 at once...

library(ggmap)

Kanazawa <- ggmap::geocode("Kanazawa", output = "latlon")
Kyoto <- ggmap::geocode("Kyoto", output = "latlon")
Nara <- ggmap::geocode("Nara", output = "latlon")

missing_tour <- rbind(Kanazawa, Kyoto, Nara)

missing_tour <- missing_tour %>% mutate(City = c("Kanazawa", "Kyoto", "Nara"),
                                        location = c("Chubu", "Kyoto", "Nara"))

missing_tour

tour <- full_join(missing_tour, tour)

# not have to run geocode each time:
write.csv(tour, "~/R_materials/japan_weather_xkcd/tour.csv")

tour <- read.csv("tour.csv", stringsAsFactors = FALSE)

glimpse(tour)

websites <- data.frame(location = c("Hokkaido", "Tohoku", "Tokyo", "Osaka", "Kobe", "Shikoku", 
                        "Hiroshima", "Kyushu", "Okinawa", "Chubu", "Kyoto"),
           tour_website = c("https://www.seejapan.co.uk/where-to-go/explore-regions/destination/hokkaido",
                            "https://www.seejapan.co.uk/where-to-go/explore-regions/destination/tohoku",
                            "https://www.seejapan.co.uk/where-to-go/explore-regions/destination/tokyo",
                            "https://www.seejapan.co.uk/where-to-go/explore-regions/destination/osaka",
                            "https://www.seejapan.co.uk/where-to-go/explore-regions/destination/kobe",
                            "https://www.seejapan.co.uk/where-to-go/explore-regions/destination/shikoku",
                            "https://www.seejapan.co.uk/where-to-go/explore-regions/destination/hiroshima",
                            "https://www.seejapan.co.uk/where-to-go/explore-regions/destination/kyushu",
                            "https://www.seejapan.co.uk/where-to-go/explore-regions/destination/okinawa",
                            "https://www.seejapan.co.uk/where-to-go/explore-regions/destination/chubu",
                            "https://www.seejapan.co.uk/where-to-go/explore-regions/destination/kyoto"
                            ))

glimpse(websites)

tour <- left_join(websites, tour, by = "location")

glimpse(tour)

```


```{r leaflet map}
library(leaflet)

leaflet(tour) %>% 
  addTiles() %>% 
  setView(lng = 137.7, lat = 36.5, zoom = 7) %>% 
  addCircles(lng = ~lon, lat = ~lat, radius = 5000, color = "darkred") %>% 
  addMarkers(lng = ~lon, lat = ~lat, 
             label = paste(
               tour$City,
               "|",
               "Winter Avg.(Celsius):", round(tour$winter_avg_temp, 2), 
               "|",
               "Summer Humidex:", round(tour$summer_humidex, 2)),
             popup = ~tour_website,
             labelOptions = labelOptions(textsize = "12px")
             )

```
